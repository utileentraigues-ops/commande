<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Catalogue & Panier</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script src="https://unpkg.com/@supabase/supabase-js"></script>
</head>
<body class="bg-gray-100 text-gray-900">

  <!-- Header -->
  <div class="p-4 bg-green-600 text-white flex justify-between">
    <h1 class="text-xl font-bold">Catalogue Produits</h1>
    <button id="view-cart" class="bg-green-700 px-4 py-2 rounded">Panier</button>
  </div>

  <!-- Catalogue -->
  <div id="catalogue" class="p-4 grid grid-cols-1 md:grid-cols-3 gap-4"></div>

  <!-- Panier -->
  <div id="cart" class="hidden p-4">
    <h2 class="text-lg font-bold mb-4">Mon Panier</h2>
    <ul id="cart-items" class="space-y-2"></ul>
    <button id="back-to-catalogue" class="bg-green-600 text-white px-4 py-2 mt-4 rounded">Retour Catalogue</button>
  </div>

  <script>
    // ‚ö°Ô∏è CONFIGURATION SUPABASE
    const SUPABASE_URL = "https://wkzfqfgzjkxowieesjbk.supabase.co";   // üëâ Mets ton URL
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndremZxZmd6amt4b3dpZWVzamJrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY0NzY5ODksImV4cCI6MjA3MjA1Mjk4OX0.PX97fuvXJE4PA8_tkXLtB5ke1oCHNLTa7yV_KDlG5Ao";               // üëâ Mets ton anon key
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    const catalogueDiv = document.getElementById("catalogue");
    const cartDiv = document.getElementById("cart");
    const cartItemsList = document.getElementById("cart-items");

    document.getElementById("view-cart").addEventListener("click", showCart);
    document.getElementById("back-to-catalogue").addEventListener("click", showCatalogue);

    // ‚úÖ Charger le catalogue depuis Supabase
    async function loadCatalogue() {
      const { data, error } = await supabase.from("catalogue").select("id, designation, groupe");
      if (error) {
        console.error("Erreur catalogue:", error);
        return;
      }
      catalogueDiv.innerHTML = "";
      data.forEach(item => {
        const card = document.createElement("div");
        card.className = "p-4 bg-white rounded shadow flex justify-between items-center";
        card.innerHTML = `
          <span>${item.designation} <small class="text-gray-500">(${item.groupe})</small></span>
          <button class="bg-green-600 text-white px-3 py-1 rounded add-to-cart" data-id="${item.id}" data-name="${item.designation}">Ajouter</button>
        `;
        catalogueDiv.appendChild(card);
      });

      document.querySelectorAll(".add-to-cart").forEach(btn => {
        btn.addEventListener("click", () => addToCart(btn.dataset.id, btn.dataset.name));
      });
    }

    // ‚úÖ Ajouter un produit au panier (quantit√© = 1 par d√©faut)
    async function addToCart(id, name) {
      // V√©rifier si d√©j√† dans le panier
      const { data: existing } = await supabase.from("panier").select("*").eq("product_id", id).single();

      if (existing) {
        // Si existe, incr√©menter la quantit√©
        await supabase.from("panier").update({ quantity: existing.quantity + 1 }).eq("id", existing.id);
      } else {
        // Sinon, ajouter avec quantit√© = 1
        await supabase.from("panier").insert([{ product_id: id, designation: name, quantity: 1 }]);
      }
      alert(`${name} ajout√© au panier`);
    }

    // ‚úÖ Afficher le panier
    async function showCart() {
      catalogueDiv.classList.add("hidden");
      cartDiv.classList.remove("hidden");

      const { data, error } = await supabase.from("panier").select("*");
      if (error) {
        console.error("Erreur panier:", error);
        return;
      }

      cartItemsList.innerHTML = "";
      data.forEach(item => {
        const li = document.createElement("li");
        li.className = "p-2 bg-white rounded shadow flex justify-between";
        li.innerHTML = `
          <span>${item.designation}</span>
          <span>Quantit√©: ${item.quantity}</span>
        `;
        cartItemsList.appendChild(li);
      });
    }

    // ‚úÖ Retour au catalogue
    function showCatalogue() {
      cartDiv.classList.add("hidden");
      catalogueDiv.classList.remove("hidden");
    }

    // Lancer au d√©marrage
    loadCatalogue();
  </script>
</body>
</html>
